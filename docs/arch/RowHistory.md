# RowHistory

RowHistory is a way of keeping track of the contents of a subset of all of the rows/objects generated by Snowfakery.

RowHistory is backed by SQLite with a temporary database which will spill to disk if memory limits are hit.

Here is the kind of recipe that might blow up memory 

```yaml
# examples/random-reference-stress-test.yml
- object: target
  count: 100_000_000
  fields:
    name: ${{id}} row
    bloat: ${{name * 10 ** 7}}

- object: test-random-reference
  count: 1
  fields:
    ref:
      random_reference: target
    name:
      ${{ref.bloat}}
```

The second object picks from one of a 100M unique strings 
which are each approx 80M in size. That's a lot of data and
would quickly blow up memory.

If we actually run this recipe we can see that RAM stays
stable about 127MB and disk space fills gradually (by design).

The RowHistory database is stored in an unlinked file, so
you must use `lsof` rather than `ls` to probe the file size.

Static analysis of the recipe determines which tables have
a row history table behind them. Tables which are not
referenced by `random_reference` do not need a backing
table.